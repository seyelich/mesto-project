(()=>{"use strict";var e={formSelector:".form",inputSelector:".form__input",fieldsetSelector:".form__input-container",submitButtonSelector:".form__button-save",inactiveButtonClass:"form__button-save_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},t=document.querySelector(".popup-photo"),n=document.querySelector(".cards"),r=t.querySelector(".popup-photo__img"),o=t.querySelector(".popup-photo__title"),c=document.querySelector(".popup-edit"),a=document.querySelector(".popup-add"),u=(document.querySelector(".popup-check"),document.querySelector(".popup-avatar")),i=document.querySelectorAll(".popup"),l=document.querySelector(".profile__button_type_edit"),s=document.querySelector(".profile__button_type_add"),d=document.querySelector(".profile__img-overlay"),f=Array.from(a.querySelectorAll(e.inputSelector)),m=document.querySelector(".profile__name"),p=document.querySelector(".profile__description"),v=c.querySelector("#name"),y=c.querySelector("#about"),_=a.querySelector(".form"),h=c.querySelector(".form"),S=u.querySelector(".form"),b=(a.querySelector("#title"),a.querySelector("#link"),document.querySelector(".profile__img")),q=u.querySelector("#avatar");function C(e){"Escape"===e.key&&k(document.querySelector(".popup_opened"))}function g(e){e.classList.add("popup_opened"),document.addEventListener("keydown",C)}function k(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",C)}var E={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"852ffeba-5671-4f68-8ab6-8c0acff8e405","Content-Type":"application/json"}};function L(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}function x(e,c,a,u,i){var l=function(e,n,c,a,u){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=i.querySelector(".card__img"),s=i.querySelector(".card__title"),d=i.querySelector(".card__delete-button"),f=i.querySelector(".card__like-button"),m=i.querySelector(".card__like-counter");return l.src=n,l.alt=e,s.textContent=e,m.textContent=c.length,i.id=u,"345b79856fbd9fc381d12a7d"!==a&&d.remove(),d.addEventListener("click",(function(e){var t=e.target.closest(".card");(function(e){return fetch("".concat(E.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:E.headers})})(t.id).then((function(e){L(e),t.remove()})).catch((function(e){return console.log(e)}))})),f.addEventListener("click",(function(e){var t=e.target.closest(".card");f.classList.contains("card__like-button_active")?function(e){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:E.headers})}(t.id).then((function(e){return L(e)})).then((function(e){m.textContent=e.likes.length,f.classList.remove("card__like-button_active")})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:E.headers})}(t.id).then((function(e){return L(e)})).then((function(e){m.textContent=e.likes.length,f.classList.add("card__like-button_active")})).catch((function(e){return console.log(e)}))})),c.some((function(e){return"345b79856fbd9fc381d12a7d"===e._id}))&&f.classList.add("card__like-button_active"),l.addEventListener("click",(function(){g(t),r.src=n,r.alt=e,o.textContent=e})),i}(e,c,a,u,i);n.prepend(l)}function A(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))}function T(t,n){n.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(t,n,e):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,n,n.validationMessage,e)}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}s.addEventListener("click",(function(){g(a)})),i.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&k(e),t.target.classList.contains("popup__button-close")&&k(e)}))})),l.addEventListener("click",(function(){g(c),v.value=m.textContent,y.value=p.textContent})),d.addEventListener("click",(function(){g(u)})),h.addEventListener("submit",(function(e){e.preventDefault();var t=h.querySelector(".form__button-save");t.textContent="Сохранение...";var n,r=e.currentTarget.elements,o=r.name,a=r.about;(n={name:o.value,about:a.value},fetch("".concat(E.baseUrl,"/users/me"),{method:"PATCH",headers:E.headers,body:JSON.stringify({name:n.name,about:n.about})})).then((function(e){L(e),m.textContent=v.value,p.textContent=y.value,k(c)})).catch((function(e){return console.log(e)})).finally((function(e){t.textContent="Сохранить"}))})),_.addEventListener("submit",(function(t){t.preventDefault();var n=_.querySelector(".form__button-save");n.textContent="Сохранение...";var r,o=t.currentTarget.elements,c=o.title,u=o.link;(r={name:c.value,link:u.value},fetch("".concat(E.baseUrl,"/cards"),{method:"POST",headers:E.headers,body:JSON.stringify({name:r.name,link:r.link})})).then((function(e){return L(e)})).then((function(t){x(t.name,t.link,t.likes,t.owner._id,t._id),k(a),A(f,n,e)})).catch((function(e){return console.log(e)})).finally((function(e){n.textContent="Создать"})),_.reset()})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.fieldsetSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);A(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){T(e,o),A(n,r,t)}))}))}(t,e)}))}))}(e),Promise.all([fetch("".concat(E.baseUrl,"/users/me"),{headers:E.headers}).then((function(e){return L(e)})),fetch("".concat(E.baseUrl,"/cards"),{headers:E.headers}).then((function(e){return L(e)}))]).then((function(e){var t,n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return c}}(n,r)||function(e,t){if(e){if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];t=c,m.textContent=t.name,p.textContent=t.about,b.src=t.avatar,function(e){e.reverse().forEach((function(e){x(e.name,e.link,e.likes,e.owner._id,e._id)}))}(a)})).catch((function(e){console.log(e)})),S.addEventListener("submit",(function(e){e.preventDefault();var t,n=S.querySelector(".form__button-save");n.textContent="Сохранение...",(t={avatar:e.currentTarget.elements.avatar.value},fetch("".concat(E.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:E.headers,body:JSON.stringify({avatar:t.avatar})})).then((function(e){L(e),b.src=q.value,k(u)})).catch((function(e){return console.log(e)})).finally((function(e){n.textContent="Сохранить"}))}))})();